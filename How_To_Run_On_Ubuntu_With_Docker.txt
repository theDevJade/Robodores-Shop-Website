Run with Docker on Ubuntu
-------------------------

Prereqs
- Install Docker Engine + Compose v2:
  sudo apt update && sudo apt install -y ca-certificates curl gnupg
  curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
  echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list
  sudo apt update && sudo apt install -y docker-ce docker-ce-cli containerd.io docker-compose-plugin
- Add your user to the docker group so you can run without sudo:
  sudo usermod -aG docker $USER
  # log out/in or run: newgrp docker

Prep the app
- From the repo root:
  cp backend/.env.example backend/.env
  # edit backend/.env if you want to change SECRET_KEY, DATABASE_URL, UPLOAD_ROOT, etc.

Start the stack
- From the repo root:
  docker compose up --build
  # add -d to detach

Use it
- Frontend: http://localhost:5173
- Backend docs: http://localhost:8000/docs
- Uploaded files live in the named volume backend_uploads; remove/reset with:
  docker volume rm robot-shop-portal_backend_uploads

LAN access
- Browse from another device: http://<host-LAN-IP>:5173
- If API calls should hit your host IP instead of localhost, set VITE_API_URL in docker-compose.yml (frontend service) to:
  http://<host-LAN-IP>:8000
- Restart after env changes:
  docker compose down
  docker compose up --build

Serve on your Wi-Fi (LAN)
- Find your host LAN IP (Ubuntu): hostname -I | awk '{print $1}' (example: 192.168.1.50)
- In docker-compose.yml (frontend service), set VITE_API_URL to your host IP: http://192.168.1.50:8000
- Recreate containers so env changes apply:
  docker compose down
  docker compose up --build
- From another device on the same Wi-Fi, open: http://192.168.1.50:5173
- Open firewall if needed: sudo ufw allow 5173/tcp and sudo ufw allow 8000/tcp

Common LAN pitfalls
- Use your real LAN IP (typically 192.168.x.x or 10.x.x.x), not the Docker bridge IP (often 172.17.x.x).
- Do not include subnet notation; use http://192.168.1.50:8000 not http://192.168.1.50/16:8000.
- The frontend URL in your browser should stay http://<LAN-IP>:5173; the frontend's VITE_API_URL should be http://<LAN-IP>:8000.

Run on startup (systemd)
- Pick a fixed repo path (example: /opt/robot-shop-portal) and ensure your user is in the docker group.
- Create the service (replace YOUR_USERNAME and the path if different):
  sudo tee /etc/systemd/system/robot-portal.service > /dev/null <<'EOF'
  [Unit]
  Description=Robot Shop Portal (Docker Compose)
  Requires=docker.service
  After=docker.service network.target

  [Service]
  Type=oneshot
  RemainAfterExit=yes
  WorkingDirectory=/opt/robot-shop-portal
  ExecStart=/usr/bin/docker compose up -d
  ExecStop=/usr/bin/docker compose down
  User=YOUR_USERNAME
  Group=docker

  [Install]
  WantedBy=multi-user.target
  EOF
- Enable and start at boot:
  sudo systemctl daemon-reload
  sudo systemctl enable --now robot-portal
- Check status/logs:
  sudo systemctl status robot-portal
  docker compose -f /opt/robot-shop-portal/docker-compose.yml ps
- Update/rebuild later:
  cd /opt/robot-shop-portal
  docker compose pull
  docker compose up -d --build
